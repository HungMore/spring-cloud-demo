### 任务记录

#### 2020.03.09

- 这周看OA JOB剥离的东西了，这个之前已经搞过，应该也不难吧。但是之前搞的，都给忘了

#### 2020.03.10

- 昨天一直在看考勤的逻辑，改动了一些，然后剩余的话，今天搞定就好了吧，测试工作没有展开，所以估计考勤这一版也没那么快能上了吧！
- OA JOB剥离的，估计也不难，重点是Jenkins部署不同的模块，自己试一下就行！

#### 2020.03.11

- 昨天touch fish了一段时间，所以基本没有写什么功能了，考勤的测试估计今天在继续开展，等测试提bug吧，除此以外，写OA JOB剥离的内容，写完估计就差不多了
- 重点是Jenkins部署多个模块的内容需要去考虑了！
- JOB剥离需要考虑的细节：
    1. 配置要实时刷新，所以JOB模块加一个实时刷新的配置
    2. OA和JOB能否共用一个Apollo项目，这样就可以保证配置的同步了，但是运行的端口号，就要不同了，可以运行时指定的呗
    3. Jenkins通过不同模块部署这一块不懂，所以先学一学Jenkins
    4. oa-xxl-job启动类的注解，有哪些是用不到的，去了解一下，然后用不到的去掉就行了
    
- 找蓝阳佳确定下客服接口的时间，然后我直接调就行。通过微服务调用的，直接一个api就行了吧。
- CRM、CMS接入OA权限架构以后，我觉得原有的登录还需要吗？好像不需要了吧，都是直接通过网关调用的。反正现在是不能用了呢。
- 客服日志的问题，要加入到阿里云那边去     
- job 剥离的，严格来说是已经搞定了吧

#### 2020.03.12

- 客服登录的问题，需要带上网关的token
- 今晚改一下客服后端的日志配置，看看是不是可以直接启动的时候搞好就行
- 静静等待吧，今晚需要加班了，等到客服使用新的分支构建了以后，明天再申请合并到master即可

#### 2020.03.13

- 今天早上主要是客服日志修改的发版，昨晚出现了问题，所以今天发。问题主要出在Jenkins构建的时候，新打包的jar包不能构建到对应的文件夹中（权限不够），导致jar包没有得到更新，一直使用的jar包都是以前构建好的jar，导致日志文件路径也是以前的。说说排查的过程：
    1. 民冰和我说日志依然在/www下。日志配置在/home下，所以出现问题
    2. 因为以前的CDN项目发版时也出现过构建错分支代码的情况，我就怀疑是不是Jenkins配置错误导致构建了master而非release的代码
    3. 为了验证猜想，对启动的jar包进行反编译，查看反编译出来的日志配置文件，发现日志配置文件的代码和release分支的不同
    4. 观察Jenkins构建输出的日志，日志明确显示构建的就是release分支，这个和猜想矛盾了，构建了release分支，却出现了非release分支的代码，很是神奇
    5. 最后通过仔细观察Jenkins的输出日志，发现构建过程是有显示某些细节失败的，只是最后的“success”懵逼了双眼
    6. 最后分析失败的日志，了解到了是Jenkins启动脚本的错误，改过来就好了。