### 任务记录

#### 2020.03.09

- 这周看OA JOB剥离的东西了，这个之前已经搞过，应该也不难吧。但是之前搞的，都给忘了

#### 2020.03.10

- 昨天一直在看考勤的逻辑，改动了一些，然后剩余的话，今天搞定就好了吧，测试工作没有展开，所以估计考勤这一版也没那么快能上了吧！
- OA JOB剥离的，估计也不难，重点是Jenkins部署不同的模块，自己试一下就行！

#### 2020.03.11

- 昨天touch fish了一段时间，所以基本没有写什么功能了，考勤的测试估计今天在继续开展，等测试提bug吧，除此以外，写OA JOB剥离的内容，写完估计就差不多了
- 重点是Jenkins部署多个模块的内容需要去考虑了！
- JOB剥离需要考虑的细节：
    1. 配置要实时刷新，所以JOB模块加一个实时刷新的配置
    2. OA和JOB能否共用一个Apollo项目，这样就可以保证配置的同步了，但是运行的端口号，就要不同了，可以运行时指定的呗
    3. Jenkins通过不同模块部署这一块不懂，所以先学一学Jenkins
    4. oa-xxl-job启动类的注解，有哪些是用不到的，去了解一下，然后用不到的去掉就行了
    
- 找蓝阳佳确定下客服接口的时间，然后我直接调就行。通过微服务调用的，直接一个api就行了吧。
- CRM、CMS接入OA权限架构以后，我觉得原有的登录还需要吗？好像不需要了吧，都是直接通过网关调用的。反正现在是不能用了呢。
- 客服日志的问题，要加入到阿里云那边去     
- job 剥离的，严格来说是已经搞定了吧

#### 2020.03.12

- 客服登录的问题，需要带上网关的token
- 今晚改一下客服后端的日志配置，看看是不是可以直接启动的时候搞好就行
- 静静等待吧，今晚需要加班了，等到客服使用新的分支构建了以后，明天再申请合并到master即可

#### 2020.03.13

- 今天早上主要是客服日志修改的发版，昨晚出现了问题，所以今天发。问题主要出在Jenkins构建的时候，新打包的jar包不能构建到对应的文件夹中（权限不够），导致jar包没有得到更新，一直使用的jar包都是以前构建好的jar，导致日志文件路径也是以前的。说说排查的过程：
    1. 民冰和我说日志依然在/www下。日志配置在/home下，所以出现问题
    2. 因为以前的CDN项目发版时也出现过构建错分支代码的情况，我就怀疑是不是Jenkins配置错误导致构建了master而非release的代码
    3. 为了验证猜想，对启动的jar包进行反编译，查看反编译出来的日志配置文件，发现日志配置文件的代码和release分支的不同
    4. 观察Jenkins构建输出的日志，日志明确显示构建的就是release分支，这个和猜想矛盾了，构建了release分支，却出现了非release分支的代码，很是神奇
    5. 最后通过仔细观察Jenkins的输出日志，发现构建过程是有显示某些细节失败的，只是最后的“success”懵逼了双眼
    6. 最后分析失败的日志，了解到了是Jenkins启动脚本的错误，改过来就好了。
    
#### 2020.03.16

- 现在手头还要这几个东西要上：
    1. OA考勤的功能，估计周二晚上上。等测试测就好了。
    2. 钉钉派单统计的功能，预计这周开始测试了吧，测试前需要合并代码，包括OA的和OA回调的，这些需要和测试沟通好，等测试通知我之后执行就好了。
    3. 客服系统接入OA权限的和调用CMS接口的，还需要和明华进行进一步的沟通（登录的接口到底还需不需要呢），然后再做打算吧
    4. OA JOB剥离的，还有一些细节需要去完成的呢，配置文件和日志配置等的东西，启动类的注解等的东西，Jenkins的部署的东西，都需要做进一步的分析和处理，然后静静等待测试就行。重点是dubbo的配置，真的不懂其中的意义，这个有点难搞
    
- 那么现在要做的就是处理好OA JOB分离的工作先了，处理完了以后准备下考勤的发版就行了，然后留意一下最新的backlog就好了。
    1. OA JOB分离好难搞啊，又要重新捋一遍OA的整体架构了，然后确定哪些配置需要哪些配置不需要，真的麻烦呐，启动类哪些注解需要，哪些注解不需要也很麻烦啊，我怎么这么菜啊，难受得很。我还是不够努力啊。
    2. 预计周一周二处理考勤和job分离的，然后周三过后处理客服的新的接口
 
#### 2020.03.17
- 先处理考勤的bug吧，然后拉取新的分支啥的，准备发版的东西就行

#### 2020.03.18
- 考勤线上的问题，下午处理吧
- 然后处理客服的东西，客服预计明天这个时候搞定
- 剩下一天半的时间处理JOB分离的，估计就可以了

#### 2020.03.19
- 客服接入OA，还需要以下东西：
    1. 现在配置了资源，但是没有配置菜单和菜单与资源的关系（这个要和前端说明，配好了也要使用SQL生成，不然线上没法在页面配）
    2. 现在鉴权统一在网关做，所以网关的token要带到请求首部的基本认证字段上，这个需要和前端明确，而且客服的cookie是不用的了（客服的登录也是不需要的了）
    3. CMS和CRM是接入了网关鉴权的，所以CMS、CRM的登录也是取消了的，需要前端自己通过请求头部的基本认证去获取CMS、CRM的权限和菜单，菜单的匹配也是前端自己搞定了
    4. 除了以上以外，客户信息查询接口也要和阳佳说了，不然赶不上了    
- OA JOB剥离的，估计也就差不多了吧，就只剩一些配置的东西需要去明确了，然后就可以测试了
- 这些活比较琐碎，实现起来吧，都不难，就是各种卡壳的感觉

今天下午处理完OA JOB剥离的，然后晚上处理下客服的菜单和资源等东西，就可以测试了。

#### 2020.03.20
- 真的很累，心太累了。动不动出点小问题，真的很难受啊。
- 客服没什么问题了，就等着师兄配置好权限，然后我添加sql就可以了
- OA JOB剥离的，需要问下民冰多模块的项目怎么选定模块进行部署了。和民冰说了，等民冰工作吧，然后之后就差不多了 
问题：
- OA有消息队列的消费者，JOB单独部署以后也会有消息队列的消费者，它们会导致消息的重复消费吗

#### 2020.03.23
- 客服的，就只剩下接口的联调了
- OA JOB剥离的，等李建回来构建下（构建新项目和OA旧项目），讲清楚需要配置的定时任务，让他测试就可以了
- 剩下好像就没什么任务了

#### 2020.03.24
- 昨天完成了客服的东西（权限配置、客户信息查询接口）
- 今天处理JOB剥离的东西，包括在测试环境的部署。剩余的问题：
    1. 测试
    2. JOB剥离会不会导致消息的重复消费等问题，需要和建波请教一下
    3. 然后问问建波这样搞还有没有需要注意的点，保险一点哈
- 然后现在开始处理考勤的东西了，把考勤的数据导入到本地库里面，然后就跑起来！    
    1. 考勤的三个列表，默认是按时间倒序吧
    2. 晚走晚到，有些全空的，需要处理一下（配合前端的页面去查看全空缘由）
    3. 审批解析的，解析出错需要发送邮件给指定的邮箱，避免出错了
    
#### 2020.03.25
- 早上先测试考勤的内容（把表的数据成功导入后就开始单元测试）
- 下午处理JOB剥离不需要的那些配置，把不需要的配置去掉，避免和OA冲突
- 然后待续吧，目前就这些功能了。

#### 2020.03.26
- 处理考勤的，审批解析的多写个if-else
- 原始记录里的审批实例没有的，直接发请求去钉钉取取看吧
- 审批解析异常发送邮件给明华吧
- 关于考勤的问题尽量今天解决
- 然后下午处理下JOB剥离的，处理掉消息消费等问题，关于配置还得询问下建波

#### 2020.03.27
- JOB剥离收尾，很麻烦呐
- 考勤捋清楚逻辑，然后输出计算逻辑
- 合并到test，让测试测一下

toto:
- job剥离，开发环境跑起来就行了
- 考勤的东西，没什么问题了，让测试跑一下就可，然后下周上线

#### 2020.03.30
新的一周又开始了，今天是没安排什么任务给我了，所以现在有点闲，没有目标就是不好，现在我都不知道该干点什么了，应该学的是什么也都不知道，真的很悲催。
自己要学的有很多，但是每一项都不知道从哪里入手，所以感觉非常的难受，想给自己一段时间去学习补充，啊，真的太难了。
- 现在是不知道该学点什么了，那可怎么办呢，想看尚硅谷的视频，然后跟着敲会好很多，但是看视频也不现实啊
- 所以啊，难受。
下午开始处理CDN定时任务的需求文档

#### 2020.03.31
今天要做的：
1. 测试，考勤的测试和JOB剥离的预发布环境测试，然后测试完了以后，明天发版。主要难点可能有：
    - 考勤的bug
    - JOB剥离要在Jenkins部署新项目，在Apollo创建新项目，oa-manager-backend的Apollo需要去掉xxl-job的配置
2. 现在要当个产品，cdn管理后台加一个接口供运维等其他人调用，不验证权限。传入url即预热url。然后还有一个JOB定时扫描预热过的url，判断url上一次预热的时间，如果上一次预热的时间在一周以前，重新预热，    
    - 完成了CDN定时任务的需求文档，后续开发由卓文负责了
    
#### 2020.04.01
今天周三，早上来到就发版，oa-xxl-job的配置都是来自oa-manager-backend，除了修改了一些必要的不冲突的配置以外，其他的都没有改动，发版时发现导出花名册的路径要和原来的一样，不然没办法下载花名册了，为此需要把oz-xxl-job部署到和oa-manager-backend一台机子上，保证各种文件都在同一目录下。但是那台机子的内存也不太够了，先分配了512M的内存，要是跑不起来再说了。
然后项目启动就看民冰的表演了，民冰处理完估计就可以了吧，有问题再说了。啊，发版总是很紧张，充分体现了我的责任感！
发完版以后执行下考勤的JOB，看看有没有报错吧！
book:
- maven实战
- maven应用实战
- 图解密码学
- Java加密与解密的艺术
- 深入剖析tomcat
- netty相关
- 深度学习的数学
- 自然语言处理
- Java自然语言处理
- 自然语言处理入门（使用HanLP）


派单统计的问题：
1. 需要统计的部门，应该包含其子部门及其子部门的人员
2. 如果是这样，判断一个用户在不在需要统计的部门里头，就需要判断其所有部门以及所有部门的父级部门在不在需要统计的部门里头了。用个set存所有部门及其父级部门，然后判断set里面是否包含需要统计部门即可
3. 这样还是挺麻烦的啊，要是有现成的接口使用就好了。。。问问卓文或者建波！

14号发版：
客服系统
审批系统
然后考勤开发

#### 2020.04.02
今天主要测试派单统计和客服客户信息查询接口，其他的倒也没怎么处理了，还有就是还跑了考勤的一些job，然后阅读了一点日志，总体还算充实吧。
明天回来把考勤的JOB都再跑一遍，然后就开发考勤的新功能吧。

#### 2020.04.03
考勤建了两个表：
- a_attendance_group_scheduling
- a_attendance_group_subsidy_relation
还需要处理的表：
- 请假时长用浮点类型
- 审批拉取完就解析，需要兼容现有的审批哦，所以要想办法处理好
- 除此以外，再见一步走一步吧
