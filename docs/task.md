### 任务记录

#### 2020.03.09

- 这周看OA JOB剥离的东西了，这个之前已经搞过，应该也不难吧。但是之前搞的，都给忘了

#### 2020.03.10

- 昨天一直在看考勤的逻辑，改动了一些，然后剩余的话，今天搞定就好了吧，测试工作没有展开，所以估计考勤这一版也没那么快能上了吧！
- OA JOB剥离的，估计也不难，重点是Jenkins部署不同的模块，自己试一下就行！

#### 2020.03.11

- 昨天touch fish了一段时间，所以基本没有写什么功能了，考勤的测试估计今天在继续开展，等测试提bug吧，除此以外，写OA JOB剥离的内容，写完估计就差不多了
- 重点是Jenkins部署多个模块的内容需要去考虑了！
- JOB剥离需要考虑的细节：
    1. 配置要实时刷新，所以JOB模块加一个实时刷新的配置
    2. OA和JOB能否共用一个Apollo项目，这样就可以保证配置的同步了，但是运行的端口号，就要不同了，可以运行时指定的呗
    3. Jenkins通过不同模块部署这一块不懂，所以先学一学Jenkins
    4. oa-xxl-job启动类的注解，有哪些是用不到的，去了解一下，然后用不到的去掉就行了
    
- 找蓝阳佳确定下客服接口的时间，然后我直接调就行。通过微服务调用的，直接一个api就行了吧。
- CRM、CMS接入OA权限架构以后，我觉得原有的登录还需要吗？好像不需要了吧，都是直接通过网关调用的。反正现在是不能用了呢。
- 客服日志的问题，要加入到阿里云那边去     
- job 剥离的，严格来说是已经搞定了吧

#### 2020.03.12

- 客服登录的问题，需要带上网关的token
- 今晚改一下客服后端的日志配置，看看是不是可以直接启动的时候搞好就行
- 静静等待吧，今晚需要加班了，等到客服使用新的分支构建了以后，明天再申请合并到master即可

#### 2020.03.13

- 今天早上主要是客服日志修改的发版，昨晚出现了问题，所以今天发。问题主要出在Jenkins构建的时候，新打包的jar包不能构建到对应的文件夹中（权限不够），导致jar包没有得到更新，一直使用的jar包都是以前构建好的jar，导致日志文件路径也是以前的。说说排查的过程：
    1. 民冰和我说日志依然在/www下。日志配置在/home下，所以出现问题
    2. 因为以前的CDN项目发版时也出现过构建错分支代码的情况，我就怀疑是不是Jenkins配置错误导致构建了master而非release的代码
    3. 为了验证猜想，对启动的jar包进行反编译，查看反编译出来的日志配置文件，发现日志配置文件的代码和release分支的不同
    4. 观察Jenkins构建输出的日志，日志明确显示构建的就是release分支，这个和猜想矛盾了，构建了release分支，却出现了非release分支的代码，很是神奇
    5. 最后通过仔细观察Jenkins的输出日志，发现构建过程是有显示某些细节失败的，只是最后的“success”懵逼了双眼
    6. 最后分析失败的日志，了解到了是Jenkins启动脚本的错误，改过来就好了。
    
#### 2020.03.16

- 现在手头还要这几个东西要上：
    1. OA考勤的功能，估计周二晚上上。等测试测就好了。
    2. 钉钉派单统计的功能，预计这周开始测试了吧，测试前需要合并代码，包括OA的和OA回调的，这些需要和测试沟通好，等测试通知我之后执行就好了。
    3. 客服系统接入OA权限的和调用CMS接口的，还需要和明华进行进一步的沟通（登录的接口到底还需不需要呢），然后再做打算吧
    4. OA JOB剥离的，还有一些细节需要去完成的呢，配置文件和日志配置等的东西，启动类的注解等的东西，Jenkins的部署的东西，都需要做进一步的分析和处理，然后静静等待测试就行。重点是dubbo的配置，真的不懂其中的意义，这个有点难搞
    
- 那么现在要做的就是处理好OA JOB分离的工作先了，处理完了以后准备下考勤的发版就行了，然后留意一下最新的backlog就好了。
    1. OA JOB分离好难搞啊，又要重新捋一遍OA的整体架构了，然后确定哪些配置需要哪些配置不需要，真的麻烦呐，启动类哪些注解需要，哪些注解不需要也很麻烦啊，我怎么这么菜啊，难受得很。我还是不够努力啊。
    2. 预计周一周二处理考勤和job分离的，然后周三过后处理客服的新的接口
 
#### 2020.03.17
- 先处理考勤的bug吧，然后拉取新的分支啥的，准备发版的东西就行

#### 2020.03.18
- 考勤线上的问题，下午处理吧
- 然后处理客服的东西，客服预计明天这个时候搞定
- 剩下一天半的时间处理JOB分离的，估计就可以了

#### 2020.03.19
- 客服接入OA，还需要以下东西：
    1. 现在配置了资源，但是没有配置菜单和菜单与资源的关系（这个要和前端说明，配好了也要使用SQL生成，不然线上没法在页面配）
    2. 现在鉴权统一在网关做，所以网关的token要带到请求首部的基本认证字段上，这个需要和前端明确，而且客服的cookie是不用的了（客服的登录也是不需要的了）
    3. CMS和CRM是接入了网关鉴权的，所以CMS、CRM的登录也是取消了的，需要前端自己通过请求头部的基本认证去获取CMS、CRM的权限和菜单，菜单的匹配也是前端自己搞定了
    4. 除了以上以外，客户信息查询接口也要和阳佳说了，不然赶不上了    
- OA JOB剥离的，估计也就差不多了吧，就只剩一些配置的东西需要去明确了，然后就可以测试了
- 这些活比较琐碎，实现起来吧，都不难，就是各种卡壳的感觉

今天下午处理完OA JOB剥离的，然后晚上处理下客服的菜单和资源等东西，就可以测试了。

#### 2020.03.20
- 真的很累，心太累了。动不动出点小问题，真的很难受啊。
- 客服没什么问题了，就等着师兄配置好权限，然后我添加sql就可以了
- OA JOB剥离的，需要问下民冰多模块的项目怎么选定模块进行部署了。和民冰说了，等民冰工作吧，然后之后就差不多了 
问题：
- OA有消息队列的消费者，JOB单独部署以后也会有消息队列的消费者，它们会导致消息的重复消费吗